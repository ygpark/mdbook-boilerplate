# 자동목차 만들기

`mdbook-autosummary.exe`는 mdBook의 폴더 구조를 기반으로 SUMMARY.md를 자동 생성하는 전처리기입니다.

## 설치 방법

### 1. 사전 컴파일된 바이너리 다운로드 (권장)

GitHub Releases 페이지에서 Windows용 바이너리를 다운로드할 수 있습니다:

1. [mdbook-autosummary Releases](https://github.com/hypergonial/mdbook-autosummary/releases) 페이지 방문
2. 최신 버전에서 `mdbook-autosummary-{version}-x86_64-pc-windows-msvc.zip` 다운로드
3. 압축 해제 후 `mdbook-autosummary.exe` 파일을 적절한 위치에 복사
4. PATH 환경변수에 해당 경로 추가

### 2. Cargo로 설치

Rust가 설치된 경우:

```cmd
cargo install mdbook-autosummary
```

## 기본 설정

### book.toml 설정

mdBook 프로젝트의 `book.toml` 파일에 다음 설정을 추가합니다:

```toml
[preprocessor.autosummary]

# mdBook이 삭제된 폴더를 다시 생성하지 않도록 설정 (필수)
[build]
create-missing = false
```

### .gitignore 설정

SUMMARY.md가 자동 생성되므로 버전 관리에서 제외:

```gitignore
# mdbook-autosummary가 자동 생성
src/SUMMARY.md
```

## 폴더 구조 요구사항

### 1. 기본 구조

모든 폴더는 반드시 `index.md` 파일을 가져야 하며, 이 파일이 해당 섹션의 링크 대상이 됩니다:

```
src/
├── index.md          # 홈페이지
├── chapter_1.md       # 개별 챕터
├── chapter_2.md
├── section1/          # 섹션 폴더
│   ├── index.md       # 섹션 메인 페이지 (필수!)
│   ├── chapter_3.md
│   └── chapter_4.md
└── section2/
    ├── index.md       # 필수
    ├── subsection/
    │   ├── index.md   # 서브섹션도 필수
    │   └── chapter_5.md
    └── chapter_6.md
```

### 2. 파일 제목 설정

각 .md 파일은 `# 제목` 형태의 h1 헤딩으로 시작해야 하며, 이것이 SUMMARY.md에서 링크 텍스트로 사용됩니다:

```markdown
# 섹션 1 소개

<!-- index.md의 내용 -->

이 섹션에서는...
```

파일에 h1 헤딩이 없으면 파일명이 제목으로 사용됩니다.

## 사용법

### 1. 초기 설정

빈 SUMMARY.md 파일을 생성합니다 (필수):

```cmd
# Windows에서
echo. > src\SUMMARY.md

# 또는 파워셸에서
New-Item -Path "src\SUMMARY.md" -ItemType File -Force
```

### 2. mdBook 빌드

일반적인 mdBook 명령어를 사용하면 자동으로 SUMMARY.md가 생성됩니다:

```cmd
# 한 번 빌드
mdbook build

# 실시간 미리보기 (파일 변경 시 자동 재생성)
mdbook serve
```

## 설정 옵션

### book.toml에서 세부 설정

```toml
[preprocessor.autosummary]
# index 파일의 이름 지정 (기본값: "index.md")
index-name = "index.md"

# 숨김 파일 무시 여부 (기본값: true)
# .으로 시작하는 파일이나 _로 시작하는 파일 무시
ignore-hidden = true

# 다른 전처리기보다 먼저 실행되도록 설정
[preprocessor.links]
after = ["autosummary"]

[preprocessor.toc]
after = ["autosummary"]
```

## 결과 예시

위의 폴더 구조에서 생성되는 SUMMARY.md:

```markdown
<!-- Generated by mdbook-autosummary v0.1.0 - do not edit manually! -->

[홈](index.md)
[챕터 1](chapter_1.md)
[챕터 2](chapter_2.md)

- [섹션 1](section1/index.md)
  - [챕터 3](section1/chapter_3.md)
  - [챕터 4](section1/chapter_4.md)
- [섹션 2](section2/index.md)
  - [서브섹션](section2/subsection/index.md)
    - [챕터 5](section2/subsection/chapter_5.md)
  - [챕터 6](section2/chapter_6.md)
```

## 주의사항 및 제한사항

### 1. 필수 준수사항

- 반드시 첫 번째 전처리기로 실행되어야 함
- 모든 섹션 폴더에 `index.md` 파일 필요
- `create-missing = false` 설정 필수
- 빈 SUMMARY.md 파일이 존재해야 함

### 2. 제한사항

내부적으로 해키한 방식으로 동작하여 몇 가지 부작용이 있습니다:

- SUMMARY.md 변경 시 mdBook이 전체 책을 다시 로드
- 다른 전처리기가 여러 번 실행될 수 있음
- 모든 백엔드에 대해 실행되지만 파일 해시 비교로 불필요한 작업 방지

### 3. 파일 삭제 시 주의점

폴더나 파일을 삭제한 후에는 SUMMARY.md를 비워주거나 삭제해야 올바르게 재생성됩니다:

```cmd
# SUMMARY.md 비우기
echo. > src\SUMMARY.md

# 또는 삭제 후 빈 파일 생성
del src\SUMMARY.md
echo. > src\SUMMARY.md
```

## 문제 해결

### 자주 발생하는 오류

1. **"SUMMARY.md doesn't exist" 오류**

   - 해결: 빈 SUMMARY.md 파일 생성

2. **섹션이 생성되지 않음**

   - 해결: 해당 폴더에 `index.md` 파일 확인

3. **제목이 파일명으로 표시됨**

   - 해결: 파일 첫 번째 줄에 `# 제목` 추가

4. **변경사항이 반영되지 않음**
   - 해결: SUMMARY.md 파일을 비우고 다시 빌드

### 디버그 방법

```cmd
# 자세한 로그와 함께 빌드
mdbook build -v

# 특정 전처리기만 실행 (테스트용)
mdbook-autosummary.exe supports html
```

## 최적 사용 패턴

### 1. 개발 워크플로우

```cmd
# 1. 새 챕터/섹션 추가
mkdir src\new_section
echo # 새 섹션 > src\new_section\index.md

# 2. SUMMARY.md 초기화
echo. > src\SUMMARY.md

# 3. 실시간 미리보기로 확인
mdbook serve
```

### 2. CI/CD 설정

```yaml
# GitHub Actions 예시
- name: Create empty SUMMARY.md
  run: echo "" > src/SUMMARY.md

- name: Build book
  run: mdbook build
```

## 대안 도구

비교할 만한 다른 도구들:

- **mdbook-auto-gen-summary**: CLI 도구와 전처리기 겸용
- **mdbook-fs-summary**: SUMMARY.md 파일 없이 작동
- **수동 스크립트**: Python/Bash 스크립트로 직접 구현

하지만 mdbook-autosummary가 가장 현대적이고 활발히 유지보수되는 도구입니다.
